(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2306:function(e,t,a){Promise.resolve().then(a.bind(a,9913))},3581:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},8728:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2023:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(9763).Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]])},9913:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var n=a(7437),s=a(2265),r=a(8614),i=a(521),c=a(2252),o=a(3581),l=a(730),u=a(8662),d=a(8178),m=a(9374),g=a(8728),h=a(2023),v=a(5863);let b=(0,a(9763).Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var x=a(3448),f=a(9376),p=a(5749),w=a(257);function S(){let{code:e}=(0,f.useParams)(),t=(0,f.useRouter)(),a=(0,s.useRef)(null),S=(0,s.useRef)(null),y=(0,s.useRef)(null),[j,k]=(0,s.useState)("preview"),[C,N]=(0,s.useState)(null),[E,M]=(0,s.useState)(!1),[D,I]=(0,s.useState)(!1),[A,L]=(0,s.useState)(null),{sendOffer:T,sendIceCandidate:Z}=(0,p.s)(null==C?void 0:C.streamId);(0,s.useEffect)(()=>{let t=async()=>{try{let t=await fetch("".concat(w.env.NEXT_PUBLIC_API_URL||"http://localhost:3001","/api/guests/join/").concat(e),{method:"POST"}),a=await t.json();if(a.error){L(a.error),k("error");return}N(a.guest)}catch(e){L("Failed to connect to server"),k("error")}};e&&t()},[e]),(0,s.useEffect)(()=>("preview"===j&&a.current&&navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}).then(e=>{y.current=e,a.current&&(a.current.srcObject=e)}).catch(e=>{console.error("Could not access camera:",e),L("Camera/Microphone access is required to join the stream.")}),()=>{"preview"===j&&y.current&&y.current.getTracks().forEach(e=>e.stop())}),[j]),(0,s.useEffect)(()=>{let e=async e=>{let{answer:t,guestId:a}=e.detail;a===(null==C?void 0:C.id)&&S.current&&(await S.current.setRemoteDescription(new RTCSessionDescription(t)),k("connected"))},t=async e=>{let{candidate:t,guestId:a}=e.detail;a===(null==C?void 0:C.id)&&S.current&&await S.current.addIceCandidate(new RTCIceCandidate(t))};return window.addEventListener("guest-answer",e),window.addEventListener("guest-ice",t),()=>{window.removeEventListener("guest-answer",e),window.removeEventListener("guest-ice",t)}},[C]);let z=async()=>{if(C&&y.current){k("joining");try{S.current=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),y.current.getTracks().forEach(e=>{var t;null===(t=S.current)||void 0===t||t.addTrack(e,y.current)}),S.current.onicecandidate=e=>{e.candidate&&Z(e.candidate,C.streamId,void 0,C.id)};let e=await S.current.createOffer();await S.current.setLocalDescription(e),T(C.streamId,e,C.id)}catch(e){console.error("WebRTC Error:",e),L("Failed to establish secure connection."),k("error")}}};return"error"===j?(0,n.jsx)("div",{className:"min-h-screen bg-surface-500 flex items-center justify-center p-6 text-white",children:(0,n.jsxs)("div",{className:"glass max-w-md w-full p-8 text-center rounded-3xl border border-red-500/20",children:[(0,n.jsx)(c.Z,{size:48,className:"text-red-400 mx-auto mb-4"}),(0,n.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Invalid Invite"}),(0,n.jsx)("p",{className:"text-gray-400 mb-6",children:A||"This invite code is invalid or has expired."}),(0,n.jsx)("button",{onClick:()=>t.push("/"),className:"w-full py-3 rounded-xl bg-white/10 hover:bg-white/20 transition-colors",children:"Back to Home"})]})}):(0,n.jsxs)("div",{className:"min-h-screen bg-surface-500 flex items-center justify-center p-6 text-white",children:[(0,n.jsxs)(r.M,{mode:"wait",children:["preview"===j&&(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},className:"glass max-w-xl w-full p-8 rounded-3xl",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-accent-burgundy to-accent-gold bg-clip-text text-transparent",children:"Ready to join?"}),(0,n.jsxs)("p",{className:"text-gray-400",children:["You've been invited by ",(null==C?void 0:C.streamId)?"Broadcaster":"..."]})]}),(0,n.jsxs)("div",{className:"relative aspect-video bg-black rounded-2xl overflow-hidden mb-8 shadow-2xl group",children:[(0,n.jsx)("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:(0,x.cn)("w-full h-full object-cover",D&&"hidden")}),D&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-surface-400",children:(0,n.jsx)(o.Z,{size:48,className:"text-gray-500 opacity-20"})}),(0,n.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[(0,n.jsx)("button",{onClick:()=>M(!E),className:(0,x.cn)("p-4 rounded-2xl backdrop-blur-md transition-all",E?"bg-red-500/80 text-white":"bg-black/40 text-white hover:bg-black/60"),title:E?"Unmute Microphone":"Mute Microphone","aria-label":E?"Unmute Microphone":"Mute Microphone",children:E?(0,n.jsx)(l.Z,{size:20}):(0,n.jsx)(u.Z,{size:20})}),(0,n.jsx)("button",{onClick:()=>I(!D),className:(0,x.cn)("p-4 rounded-2xl backdrop-blur-md transition-all",D?"bg-red-500/80 text-white":"bg-black/40 text-white hover:bg-black/60"),title:D?"Start Camera":"Stop Camera","aria-label":D?"Start Camera":"Stop Camera",children:D?(0,n.jsx)(d.Z,{size:20}):(0,n.jsx)(m.Z,{size:20})}),(0,n.jsx)("button",{className:"p-4 rounded-2xl bg-black/40 backdrop-blur-md text-white hover:bg-black/60 transition-all",title:"Camera & Audio Settings","aria-label":"Camera & Audio Settings",children:(0,n.jsx)(g.Z,{size:20})})]})]}),(0,n.jsxs)("button",{onClick:z,className:"w-full py-4 rounded-2xl bg-gradient-to-r from-accent-burgundy to-accent-gold text-white font-bold text-lg shadow-neon-burgundy hover:shadow-neon-gold transition-all flex items-center justify-center gap-3",children:[(0,n.jsx)(h.Z,{size:20}),"Join Stream"]})]}),"joining"===j&&(0,n.jsxs)(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center",children:[(0,n.jsx)(v.Z,{size:64,className:"text-accent-gold animate-spin mx-auto mb-6"}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Connecting to Studio..."}),(0,n.jsx)("p",{className:"text-gray-400",children:"Negotiating WebRTC session"})]}),"connected"===j&&(0,n.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"glass max-w-md w-full p-12 rounded-3xl text-center",children:[(0,n.jsx)(b,{size:64,className:"text-green-400 mx-auto mb-6"}),(0,n.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"You're In!"}),(0,n.jsx)("p",{className:"text-gray-400 mb-8",children:"You are now broadcasting to the studio. Break a leg!"}),(0,n.jsx)("div",{className:"p-4 rounded-2xl bg-green-500/10 border border-green-500/20 text-green-300 text-sm",children:"Always keep this tab open during the stream."})]})]}),(0,n.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-1/4 -left-20 w-96 h-96 bg-accent-gold/10 rounded-full blur-[120px]"}),(0,n.jsx)("div",{className:"absolute bottom-1/4 -right-20 w-96 h-96 bg-accent-burgundy/10 rounded-full blur-[120px]"})]})]})}},5749:function(e,t,a){"use strict";a.d(t,{s:function(){return c}});var n=a(2265),s=a(8680),r=a(2371);let i=a(257).env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:3001";function c(e){let t=(0,n.useRef)(null),{addChatMessage:a,addGuest:c,removeGuest:o,updateGuestStatus:l,setAnalytics:u}=(0,r.D)();(0,n.useEffect)(()=>{t.current=(0,s.io)(i,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});let n=t.current;return n.on("connect",()=>{console.log("Connected to WebSocket server"),e&&n.emit("stream:join",e)}),n.on("disconnect",()=>{console.log("Disconnected from WebSocket server")}),n.on("chat:message",e=>{a({id:e.id||"msg-".concat(Date.now()),platform:e.platform,username:e.username,message:e.message,timestamp:new Date(e.timestamp),highlighted:e.highlighted||!1,donation:e.donation})}),n.on("guest:joined",e=>{c({id:e.id||e.guestId,name:e.name,status:"connected",videoEnabled:!0,audioEnabled:!0,connectionQuality:"excellent"})}),n.on("guest:left",e=>{o(e.id||e.guestId)}),n.on("stream:viewers",e=>{let t=r.D.getState();t.stream&&t.setStream({...t.stream,viewerCount:e.count})}),n.on("scene:switched",e=>{let t=r.D.getState(),a=t.scenes.find(t=>t.id===e.sceneId);a&&t.setActiveScene(a)}),n.on("guest:signal:offer",e=>{let t=new CustomEvent("guest-offer",{detail:e});window.dispatchEvent(t)}),n.on("guest:signal:answer",e=>{let t=new CustomEvent("guest-answer",{detail:e});window.dispatchEvent(t)}),n.on("guest:signal:ice",e=>{let t=new CustomEvent("guest-ice",{detail:e});window.dispatchEvent(t)}),()=>{n.disconnect()}},[e,a,c,o]);let d=(0,n.useCallback)(a=>{t.current&&e&&t.current.emit("stream:start",{streamId:e,platforms:a})},[e]),m=(0,n.useCallback)(()=>{t.current&&e&&t.current.emit("stream:stop",e)},[e]),g=(0,n.useCallback)(a=>{t.current&&e&&t.current.emit("scene:switch",{streamId:e,sceneId:a})},[e]),h=(0,n.useCallback)((a,n)=>{t.current&&e&&t.current.emit("avatar:speak",{streamId:e,text:a,avatarId:n})},[e]),v=(0,n.useCallback)(a=>{t.current&&e&&t.current.emit("chat:message",{streamId:e,...a})},[e]),b=(0,n.useCallback)((e,a,n)=>{t.current&&t.current.emit("guest:signal:offer",{streamId:e,offer:a,guestId:n})},[]),x=(0,n.useCallback)((e,a,n)=>{t.current&&t.current.emit("guest:signal:answer",{targetSocketId:e,answer:a,guestId:n})},[]),f=(0,n.useCallback)((e,a,n,s)=>{t.current&&t.current.emit("guest:signal:ice",{streamId:a,targetSocketId:n,candidate:e,guestId:s})},[]);return{socket:t.current,startStream:d,stopStream:m,switchScene:g,speakWithAvatar:h,sendChatMessage:v,sendOffer:b,sendAnswer:x,sendIceCandidate:f}}},2371:function(e,t,a){"use strict";a.d(t,{D:function(){return n}});let n=(0,a(9625).Ue)((e,t)=>({stream:null,isStreaming:!1,streamDuration:0,scenes:[],activeScene:null,previewScene:null,isTransitioning:!1,avatars:[],activeAvatar:null,avatarSessionId:null,chatMessages:[],chatPaused:!1,guests:[],analytics:null,sidebarOpen:!0,activePanel:"scenes",aiDirectorEnabled:!1,directorLogs:[],aiInsights:null,setAiDirectorEnabled:t=>e({aiDirectorEnabled:t}),addDirectorLog:t=>e(e=>({directorLogs:[{...t,id:Math.random().toString(36).substr(2,9),timestamp:new Date},...e.directorLogs].slice(0,50)})),setDirectorLogs:t=>e({directorLogs:t}),setAiInsights:t=>e({aiInsights:t}),setStream:t=>e({stream:t}),startStream:()=>e({isStreaming:!0,stream:t().stream?{...t().stream,status:"live",startedAt:new Date}:null}),stopStream:()=>e({isStreaming:!1,streamDuration:0,stream:t().stream?{...t().stream,status:"ended",endedAt:new Date}:null}),updateStreamDuration:t=>e({streamDuration:t}),setScenes:t=>e({scenes:t}),addScene:t=>e(e=>({scenes:[...e.scenes,t]})),removeScene:t=>e(e=>{var a;return{scenes:e.scenes.filter(e=>e.id!==t),activeScene:(null===(a=e.activeScene)||void 0===a?void 0:a.id)===t?null:e.activeScene}}),setActiveScene:t=>e({activeScene:t}),setPreviewScene:t=>e({previewScene:t}),setIsTransitioning:t=>e({isTransitioning:t}),setAvatars:t=>e({avatars:t}),setActiveAvatar:t=>e({activeAvatar:t}),setAvatarSessionId:t=>e({avatarSessionId:t}),speakWithAvatar:a=>{let n=t().activeAvatar;n&&(e({activeAvatar:{...n,status:"speaking"}}),setTimeout(()=>{e({activeAvatar:{...n,status:"idle"}})},50*a.length))},addChatMessage:t=>e(e=>({chatMessages:[...e.chatMessages.slice(-99),t]})),clearChat:()=>e({chatMessages:[]}),toggleChatPause:()=>e(e=>({chatPaused:!e.chatPaused})),addGuest:t=>e(e=>({guests:[...e.guests,t]})),removeGuest:t=>e(e=>({guests:e.guests.filter(e=>e.id!==t)})),updateGuestStatus:(t,a)=>e(e=>({guests:e.guests.map(e=>e.id===t?{...e,status:a}:e)})),setAnalytics:t=>e({analytics:t}),toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen})),setActivePanel:t=>e({activePanel:t})}))},3448:function(e,t,a){"use strict";a.d(t,{BK:function(){return o},LU:function(){return i},cn:function(){return r},uf:function(){return c}});var n=a(1994),s=a(3335);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,n.W)(t))}function i(e){let t=Math.floor(e/3600),a=Math.floor(e%3600/60),n=e%60;return t>0?"".concat(t,":").concat(a.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(a,":").concat(n.toString().padStart(2,"0"))}function c(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}function o(e){let t=new Date,a=new Date(e),n=Math.floor((t.getTime()-a.getTime())/1e3);return n<60?"just now":n<3600?"".concat(Math.floor(n/60),"m ago"):n<86400?"".concat(Math.floor(n/3600),"h ago"):"".concat(Math.floor(n/86400),"d ago")}}},function(e){e.O(0,[230,540,971,117,744],function(){return e(e.s=2306)}),_N_E=e.O()}]);