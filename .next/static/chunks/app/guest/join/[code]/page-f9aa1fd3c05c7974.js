(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2306:function(e,t,n){Promise.resolve().then(n.bind(n,9913))},3581:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},8728:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2023:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]])},257:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var o=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?o=r.concat(o):u=-1,o.length&&m())}function m(){if(!l){var e=c(d);l=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new h(e,t)),1!==o.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}},i=!0;try{t[e](s,s.exports,r),i=!1}finally{i&&delete n[e]}return s.exports}r.ab="//";var a=r(229);e.exports=a}()},9913:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(7437),a=n(2265),s=n(8614),i=n(521),c=n(2252),o=n(3581),l=n(730),u=n(8662),d=n(8178),m=n(9374),h=n(8728),g=n(2023),f=n(5863);let v=(0,n(9763).Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var p=n(3448),b=n(9376),x=n(5749),w=n(257);function y(){let{code:e}=(0,b.useParams)(),t=(0,b.useRouter)(),n=(0,a.useRef)(null),y=(0,a.useRef)(null),S=(0,a.useRef)(null),[j,k]=(0,a.useState)("preview"),[C,N]=(0,a.useState)(null),[E,T]=(0,a.useState)(!1),[M,A]=(0,a.useState)(!1),[D,L]=(0,a.useState)(null),{sendOffer:I,sendIceCandidate:Z}=(0,x.s)(null==C?void 0:C.streamId);(0,a.useEffect)(()=>{let t=async()=>{try{let t=await fetch("".concat(w.env.NEXT_PUBLIC_API_URL||"http://localhost:3001","/api/guests/join/").concat(e),{method:"POST"}),n=await t.json();if(n.error){L(n.error),k("error");return}N(n.guest)}catch(e){L("Failed to connect to server"),k("error")}};e&&t()},[e]),(0,a.useEffect)(()=>("preview"===j&&n.current&&navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}).then(e=>{S.current=e,n.current&&(n.current.srcObject=e)}).catch(e=>{console.error("Could not access camera:",e),L("Camera/Microphone access is required to join the stream.")}),()=>{"preview"===j&&S.current&&S.current.getTracks().forEach(e=>e.stop())}),[j]),(0,a.useEffect)(()=>{let e=async e=>{let{answer:t,guestId:n}=e.detail;n===(null==C?void 0:C.id)&&y.current&&(await y.current.setRemoteDescription(new RTCSessionDescription(t)),k("connected"))},t=async e=>{let{candidate:t,guestId:n}=e.detail;n===(null==C?void 0:C.id)&&y.current&&await y.current.addIceCandidate(new RTCIceCandidate(t))};return window.addEventListener("guest-answer",e),window.addEventListener("guest-ice",t),()=>{window.removeEventListener("guest-answer",e),window.removeEventListener("guest-ice",t)}},[C]);let z=async()=>{if(C&&S.current){k("joining");try{y.current=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),S.current.getTracks().forEach(e=>{var t;null===(t=y.current)||void 0===t||t.addTrack(e,S.current)}),y.current.onicecandidate=e=>{e.candidate&&Z(e.candidate,C.streamId,void 0,C.id)};let e=await y.current.createOffer();await y.current.setLocalDescription(e),I(C.streamId,e,C.id)}catch(e){console.error("WebRTC Error:",e),L("Failed to establish secure connection."),k("error")}}};return"error"===j?(0,r.jsx)("div",{className:"min-h-screen bg-surface-500 flex items-center justify-center p-6 text-white",children:(0,r.jsxs)("div",{className:"glass max-w-md w-full p-8 text-center rounded-3xl border border-red-500/20",children:[(0,r.jsx)(c.Z,{size:48,className:"text-red-400 mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Invalid Invite"}),(0,r.jsx)("p",{className:"text-gray-400 mb-6",children:D||"This invite code is invalid or has expired."}),(0,r.jsx)("button",{onClick:()=>t.push("/"),className:"w-full py-3 rounded-xl bg-white/10 hover:bg-white/20 transition-colors",children:"Back to Home"})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-surface-500 flex items-center justify-center p-6 text-white",children:[(0,r.jsxs)(s.M,{mode:"wait",children:["preview"===j&&(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},className:"glass max-w-xl w-full p-8 rounded-3xl",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-accent-burgundy to-accent-gold bg-clip-text text-transparent",children:"Ready to join?"}),(0,r.jsxs)("p",{className:"text-gray-400",children:["You've been invited by ",(null==C?void 0:C.streamId)?"Broadcaster":"..."]})]}),(0,r.jsxs)("div",{className:"relative aspect-video bg-black rounded-2xl overflow-hidden mb-8 shadow-2xl group",children:[(0,r.jsx)("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:(0,p.cn)("w-full h-full object-cover",M&&"hidden")}),M&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-surface-400",children:(0,r.jsx)(o.Z,{size:48,className:"text-gray-500 opacity-20"})}),(0,r.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[(0,r.jsx)("button",{onClick:()=>T(!E),className:(0,p.cn)("p-4 rounded-2xl backdrop-blur-md transition-all",E?"bg-red-500/80 text-white":"bg-black/40 text-white hover:bg-black/60"),title:E?"Unmute Microphone":"Mute Microphone","aria-label":E?"Unmute Microphone":"Mute Microphone",children:E?(0,r.jsx)(l.Z,{size:20}):(0,r.jsx)(u.Z,{size:20})}),(0,r.jsx)("button",{onClick:()=>A(!M),className:(0,p.cn)("p-4 rounded-2xl backdrop-blur-md transition-all",M?"bg-red-500/80 text-white":"bg-black/40 text-white hover:bg-black/60"),title:M?"Start Camera":"Stop Camera","aria-label":M?"Start Camera":"Stop Camera",children:M?(0,r.jsx)(d.Z,{size:20}):(0,r.jsx)(m.Z,{size:20})}),(0,r.jsx)("button",{className:"p-4 rounded-2xl bg-black/40 backdrop-blur-md text-white hover:bg-black/60 transition-all",title:"Camera & Audio Settings","aria-label":"Camera & Audio Settings",children:(0,r.jsx)(h.Z,{size:20})})]})]}),(0,r.jsxs)("button",{onClick:z,className:"w-full py-4 rounded-2xl bg-gradient-to-r from-accent-burgundy to-accent-gold text-white font-bold text-lg shadow-neon-burgundy hover:shadow-neon-gold transition-all flex items-center justify-center gap-3",children:[(0,r.jsx)(g.Z,{size:20}),"Join Stream"]})]}),"joining"===j&&(0,r.jsxs)(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center",children:[(0,r.jsx)(f.Z,{size:64,className:"text-accent-gold animate-spin mx-auto mb-6"}),(0,r.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Connecting to Studio..."}),(0,r.jsx)("p",{className:"text-gray-400",children:"Negotiating WebRTC session"})]}),"connected"===j&&(0,r.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"glass max-w-md w-full p-12 rounded-3xl text-center",children:[(0,r.jsx)(v,{size:64,className:"text-green-400 mx-auto mb-6"}),(0,r.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"You're In!"}),(0,r.jsx)("p",{className:"text-gray-400 mb-8",children:"You are now broadcasting to the studio. Break a leg!"}),(0,r.jsx)("div",{className:"p-4 rounded-2xl bg-green-500/10 border border-green-500/20 text-green-300 text-sm",children:"Always keep this tab open during the stream."})]})]}),(0,r.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-1/4 -left-20 w-96 h-96 bg-accent-gold/10 rounded-full blur-[120px]"}),(0,r.jsx)("div",{className:"absolute bottom-1/4 -right-20 w-96 h-96 bg-accent-burgundy/10 rounded-full blur-[120px]"})]})]})}},5749:function(e,t,n){"use strict";n.d(t,{s:function(){return c}});var r=n(2265),a=n(8680),s=n(2371);let i=n(257).env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:3001";function c(e){let t=(0,r.useRef)(null),{addChatMessage:n,addGuest:c,removeGuest:o,updateGuestStatus:l,setAnalytics:u}=(0,s.D)();(0,r.useEffect)(()=>{t.current=(0,a.io)(i,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});let r=t.current;return r.on("connect",()=>{console.log("Connected to WebSocket server"),e&&r.emit("stream:join",e)}),r.on("disconnect",()=>{console.log("Disconnected from WebSocket server")}),r.on("chat:message",e=>{n({id:e.id||"msg-".concat(Date.now()),platform:e.platform,username:e.username,message:e.message,timestamp:new Date(e.timestamp),highlighted:e.highlighted||!1,donation:e.donation})}),r.on("guest:joined",e=>{c({id:e.id||e.guestId,name:e.name,status:"connected",videoEnabled:!0,audioEnabled:!0,connectionQuality:"excellent"})}),r.on("guest:left",e=>{o(e.id||e.guestId)}),r.on("stream:viewers",e=>{let t=s.D.getState();t.stream&&t.setStream({...t.stream,viewerCount:e.count})}),r.on("scene:switched",e=>{let t=s.D.getState(),n=t.scenes.find(t=>t.id===e.sceneId);n&&t.setActiveScene(n)}),r.on("guest:signal:offer",e=>{let t=new CustomEvent("guest-offer",{detail:e});window.dispatchEvent(t)}),r.on("guest:signal:answer",e=>{let t=new CustomEvent("guest-answer",{detail:e});window.dispatchEvent(t)}),r.on("guest:signal:ice",e=>{let t=new CustomEvent("guest-ice",{detail:e});window.dispatchEvent(t)}),()=>{r.disconnect()}},[e,n,c,o]);let d=(0,r.useCallback)(n=>{t.current&&e&&t.current.emit("stream:start",{streamId:e,platforms:n})},[e]),m=(0,r.useCallback)(()=>{t.current&&e&&t.current.emit("stream:stop",e)},[e]),h=(0,r.useCallback)(n=>{t.current&&e&&t.current.emit("scene:switch",{streamId:e,sceneId:n})},[e]),g=(0,r.useCallback)((n,r)=>{t.current&&e&&t.current.emit("avatar:speak",{streamId:e,text:n,avatarId:r})},[e]),f=(0,r.useCallback)(n=>{t.current&&e&&t.current.emit("chat:message",{streamId:e,...n})},[e]),v=(0,r.useCallback)((e,n,r)=>{t.current&&t.current.emit("guest:signal:offer",{streamId:e,offer:n,guestId:r})},[]),p=(0,r.useCallback)((e,n,r)=>{t.current&&t.current.emit("guest:signal:answer",{targetSocketId:e,answer:n,guestId:r})},[]),b=(0,r.useCallback)((e,n,r,a)=>{t.current&&t.current.emit("guest:signal:ice",{streamId:n,targetSocketId:r,candidate:e,guestId:a})},[]);return{socket:t.current,startStream:d,stopStream:m,switchScene:h,speakWithAvatar:g,sendChatMessage:f,sendOffer:v,sendAnswer:p,sendIceCandidate:b}}},2371:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});let r=(0,n(9625).Ue)((e,t)=>({stream:null,isStreaming:!1,streamDuration:0,scenes:[],activeScene:null,previewScene:null,isTransitioning:!1,avatars:[],activeAvatar:null,avatarSessionId:null,chatMessages:[],chatPaused:!1,guests:[],analytics:null,sidebarOpen:!0,activePanel:"scenes",aiDirectorEnabled:!1,directorLogs:[],aiInsights:null,setAiDirectorEnabled:t=>e({aiDirectorEnabled:t}),addDirectorLog:t=>e(e=>({directorLogs:[{...t,id:Math.random().toString(36).substr(2,9),timestamp:new Date},...e.directorLogs].slice(0,50)})),setDirectorLogs:t=>e({directorLogs:t}),setAiInsights:t=>e({aiInsights:t}),setStream:t=>e({stream:t}),startStream:()=>e({isStreaming:!0,stream:t().stream?{...t().stream,status:"live",startedAt:new Date}:null}),stopStream:()=>e({isStreaming:!1,streamDuration:0,stream:t().stream?{...t().stream,status:"ended",endedAt:new Date}:null}),updateStreamDuration:t=>e({streamDuration:t}),setScenes:t=>e({scenes:t}),addScene:t=>e(e=>({scenes:[...e.scenes,t]})),removeScene:t=>e(e=>{var n;return{scenes:e.scenes.filter(e=>e.id!==t),activeScene:(null===(n=e.activeScene)||void 0===n?void 0:n.id)===t?null:e.activeScene}}),setActiveScene:t=>e({activeScene:t}),setPreviewScene:t=>e({previewScene:t}),setIsTransitioning:t=>e({isTransitioning:t}),setAvatars:t=>e({avatars:t}),setActiveAvatar:t=>e({activeAvatar:t}),setAvatarSessionId:t=>e({avatarSessionId:t}),speakWithAvatar:n=>{let r=t().activeAvatar;r&&(e({activeAvatar:{...r,status:"speaking"}}),setTimeout(()=>{e({activeAvatar:{...r,status:"idle"}})},50*n.length))},addChatMessage:t=>e(e=>({chatMessages:[...e.chatMessages.slice(-99),t]})),clearChat:()=>e({chatMessages:[]}),toggleChatPause:()=>e(e=>({chatPaused:!e.chatPaused})),addGuest:t=>e(e=>({guests:[...e.guests,t]})),removeGuest:t=>e(e=>({guests:e.guests.filter(e=>e.id!==t)})),updateGuestStatus:(t,n)=>e(e=>({guests:e.guests.map(e=>e.id===t?{...e,status:n}:e)})),setAnalytics:t=>e({analytics:t}),toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen})),setActivePanel:t=>e({activePanel:t})}))},3448:function(e,t,n){"use strict";n.d(t,{BK:function(){return o},LU:function(){return i},cn:function(){return s},uf:function(){return c}});var r=n(1994),a=n(3335);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}function i(e){let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return t>0?"".concat(t,":").concat(n.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0")):"".concat(n,":").concat(r.toString().padStart(2,"0"))}function c(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}function o(e){let t=new Date,n=new Date(e),r=Math.floor((t.getTime()-n.getTime())/1e3);return r<60?"just now":r<3600?"".concat(Math.floor(r/60),"m ago"):r<86400?"".concat(Math.floor(r/3600),"h ago"):"".concat(Math.floor(r/86400),"d ago")}}},function(e){e.O(0,[230,24,971,117,744],function(){return e(e.s=2306)}),_N_E=e.O()}]);