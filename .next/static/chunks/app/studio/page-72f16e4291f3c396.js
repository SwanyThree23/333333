(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[348],{7945:function(e,t,s){Promise.resolve().then(s.bind(s,4965))},4965:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eW}});var a=s(7437),i=s(2265),l=s(521),n=s(2451),r=s(407),c=s(5901),o=s(1723),d=s(2208),x=s(8662),m=s(9374),u=s(3417),h=s(7806),p=s(8728),g=s(8124),b=s(3468),j=s(5805),f=s(3448);let v=(0,s(9625).Ue)((e,t)=>({stream:null,isStreaming:!1,streamDuration:0,scenes:[],activeScene:null,previewScene:null,avatars:[],activeAvatar:null,avatarSessionId:null,chatMessages:[],chatPaused:!1,guests:[],analytics:null,sidebarOpen:!0,activePanel:"scenes",setStream:t=>e({stream:t}),startStream:()=>e({isStreaming:!0,stream:t().stream?{...t().stream,status:"live",startedAt:new Date}:null}),stopStream:()=>e({isStreaming:!1,streamDuration:0,stream:t().stream?{...t().stream,status:"ended",endedAt:new Date}:null}),updateStreamDuration:t=>e({streamDuration:t}),setScenes:t=>e({scenes:t}),addScene:t=>e(e=>({scenes:[...e.scenes,t]})),removeScene:t=>e(e=>{var s;return{scenes:e.scenes.filter(e=>e.id!==t),activeScene:(null===(s=e.activeScene)||void 0===s?void 0:s.id)===t?null:e.activeScene}}),setActiveScene:t=>e({activeScene:t}),setPreviewScene:t=>e({previewScene:t}),setAvatars:t=>e({avatars:t}),setActiveAvatar:t=>e({activeAvatar:t}),setAvatarSessionId:t=>e({avatarSessionId:t}),speakWithAvatar:s=>{let a=t().activeAvatar;a&&(e({activeAvatar:{...a,status:"speaking"}}),setTimeout(()=>{e({activeAvatar:{...a,status:"idle"}})},50*s.length))},addChatMessage:t=>e(e=>({chatMessages:[...e.chatMessages.slice(-99),t]})),clearChat:()=>e({chatMessages:[]}),toggleChatPause:()=>e(e=>({chatPaused:!e.chatPaused})),addGuest:t=>e(e=>({guests:[...e.guests,t]})),removeGuest:t=>e(e=>({guests:e.guests.filter(e=>e.id!==t)})),updateGuestStatus:(t,s)=>e(e=>({guests:e.guests.map(e=>e.id===t?{...e,status:s}:e)})),setAnalytics:t=>e({analytics:t}),toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen})),setActivePanel:t=>e({activePanel:t})}));var y=s(8614),N=s(8554),w=s(1473),S=s(1740),k=s(2023),z=s(3581),Z=s(3113),C=s(9202),E=s(5277),T=s(9397),A=s(1905),I=s(7769),L=s(6337),P=s(9711),_=s(8930);let F=[{id:"single",label:"Single",icon:(0,a.jsx)(c.Z,{size:16})},{id:"side-by-side",label:"Side by Side",icon:(0,a.jsx)(b.Z,{size:16})},{id:"pip",label:"Picture in Picture",icon:(0,a.jsx)(N.Z,{size:16})},{id:"grid",label:"Grid",icon:(0,a.jsx)(w.Z,{size:16})},{id:"custom",label:"Custom",icon:(0,a.jsx)(S.Z,{size:16})}],D=[{type:"avatar",label:"AI Avatar",icon:(0,a.jsx)(k.Z,{size:16})},{type:"camera",label:"Camera",icon:(0,a.jsx)(z.Z,{size:16})},{type:"screen",label:"Screen Share",icon:(0,a.jsx)(c.Z,{size:16})},{type:"image",label:"Image",icon:(0,a.jsx)(Z.Z,{size:16})},{type:"video",label:"Video",icon:(0,a.jsx)(m.Z,{size:16})},{type:"browser",label:"Browser",icon:(0,a.jsx)(C.Z,{size:16})},{type:"text",label:"Text",icon:(0,a.jsx)(E.Z,{size:16})}];function U(e){let{className:t}=e,{activeScene:s,scenes:n,setActiveScene:r,addScene:c,removeScene:o}=v(),[x,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(null),p=(0,i.useRef)(null),b=e=>{s&&r({...s,layout:e})},j=e=>{if(!s)return;let t={id:"source-".concat(Date.now()),type:e,name:"".concat(e.charAt(0).toUpperCase()+e.slice(1)," Source"),position:{x:50,y:50},size:{width:400,height:300},zIndex:s.sources.length,visible:!0,locked:!1,settings:{}};r({...s,sources:[...s.sources,t]}),m(!1)},N=e=>{s&&r({...s,sources:s.sources.map(t=>t.id===e?{...t,visible:!t.visible}:t)})},w=e=>{s&&r({...s,sources:s.sources.map(t=>t.id===e?{...t,locked:!t.locked}:t)})},S=e=>{s&&r({...s,sources:s.sources.filter(t=>t.id!==e)})},k=e=>{let t=D.find(t=>t.type===e);return(null==t?void 0:t.icon)||(0,a.jsx)(g.Z,{size:16})};return(0,a.jsxs)("div",{className:(0,f.cn)("glass rounded-2xl p-4",t),children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,a.jsx)(g.Z,{size:18,className:"text-accent-cyan"}),"Scene Layout"]})}),s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-2",children:"Layout Type"}),(0,a.jsx)("div",{className:"grid grid-cols-5 gap-1",children:F.map(e=>(0,a.jsxs)("button",{onClick:()=>b(e.id),className:(0,f.cn)("p-2 rounded-lg flex flex-col items-center gap-1 transition-colors",s.layout===e.id?"bg-accent-cyan/20 text-accent-cyan border border-accent-cyan/50":"bg-white/5 hover:bg-white/10 text-gray-400"),title:e.label,children:[e.icon,(0,a.jsx)("span",{className:"text-[10px]",children:e.label})]},e.id))})]}),(0,a.jsxs)("div",{ref:p,className:"relative aspect-video bg-surface-500 rounded-xl overflow-hidden mb-4 border border-white/10",children:[s.sources.map(e=>(0,a.jsx)(l.E.div,{className:(0,f.cn)("absolute rounded-lg border-2 flex items-center justify-center transition-all cursor-move",e.visible?"opacity-100":"opacity-30",e.locked?"border-gray-500":"border-accent-cyan",u===e.id&&"ring-2 ring-accent-purple"),style:{left:"".concat(e.position.x,"%"),top:"".concat(e.position.y,"%"),width:"30%",height:"40%",transform:"translate(-50%, -50%)",zIndex:e.zIndex},onClick:()=>h(e.id),children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 mx-auto bg-white/10 rounded-lg flex items-center justify-center mb-1",children:k(e.type)}),(0,a.jsx)("span",{className:"text-[10px] text-gray-400",children:e.name})]})},e.id)),0===s.sources.length&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(g.Z,{size:32,className:"mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"No sources added"})]})})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"text-xs text-gray-400",children:"Sources"}),(0,a.jsx)("button",{onClick:()=>m(!x),className:"p-1 rounded-md bg-accent-cyan/20 text-accent-cyan hover:bg-accent-cyan/30 transition-colors",title:"Add Source","aria-label":"Add Source",children:(0,a.jsx)(T.Z,{size:14})})]}),(0,a.jsx)(y.M,{children:x&&(0,a.jsx)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid grid-cols-4 gap-1 p-2 bg-white/5 rounded-lg overflow-hidden",children:D.map(e=>(0,a.jsxs)("button",{onClick:()=>j(e.type),className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 flex flex-col items-center gap-1 transition-colors",children:[e.icon,(0,a.jsx)("span",{className:"text-[10px] text-gray-400",children:e.label})]},e.type))})}),(0,a.jsx)("div",{className:"space-y-1 max-h-[150px] overflow-y-auto",children:s.sources.map((e,t)=>(0,a.jsxs)("div",{className:(0,f.cn)("flex items-center gap-2 p-2 rounded-lg transition-colors",u===e.id?"bg-accent-purple/20 border border-accent-purple/50":"bg-white/5 hover:bg-white/10"),onClick:()=>h(e.id),children:[(0,a.jsx)(A.Z,{size:14,className:"text-gray-500 cursor-grab"}),(0,a.jsx)("div",{className:"w-6 h-6 rounded bg-white/10 flex items-center justify-center",children:k(e.type)}),(0,a.jsx)("span",{className:"flex-1 text-sm truncate",children:e.name}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),N(e.id)},className:(0,f.cn)("p-1 rounded",e.visible?"text-gray-400":"text-red-400"),title:e.visible?"Hide":"Show",children:e.visible?(0,a.jsx)(d.Z,{size:12}):(0,a.jsx)(I.Z,{size:12})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),w(e.id)},className:(0,f.cn)("p-1 rounded",e.locked?"text-yellow-400":"text-gray-400"),title:e.locked?"Unlock":"Lock",children:e.locked?(0,a.jsx)(L.Z,{size:12}):(0,a.jsx)(P.Z,{size:12})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),S(e.id)},className:"p-1 rounded text-red-400 hover:bg-red-400/20",title:"Remove",children:(0,a.jsx)(_.Z,{size:12})})]},e.id))})]}),(0,a.jsxs)("div",{className:"border-t border-white/10 pt-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-2",children:"Scene Transition"}),(0,a.jsx)("div",{className:"grid grid-cols-4 gap-1",children:["cut","fade","slide","zoom"].map(e=>(0,a.jsx)("button",{onClick:()=>{s&&r({...s,transitionType:e})},className:(0,f.cn)("p-2 rounded-lg text-xs capitalize transition-colors",s.transitionType===e?"bg-accent-purple/20 text-accent-purple border border-accent-purple/50":"bg-white/5 hover:bg-white/10 text-gray-400"),children:e},e))})]})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(g.Z,{size:32,className:"mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"No scene selected"}),(0,a.jsx)("p",{className:"text-xs",children:"Select a scene to edit its layout"})]})]})}function R(e){let{className:t}=e,{scenes:s,activeScene:n,previewScene:r,setActiveScene:c,setPreviewScene:o,addScene:d}=v(),[x,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(""),p=()=>{u.trim()&&(d({id:"scene-".concat(Date.now()),name:u,sources:[],layout:"single",transitionType:"fade",transitionDuration:300}),h(""),m(!1))};return(0,a.jsxs)("div",{className:(0,f.cn)("glass rounded-2xl p-4",t),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm",children:"Scenes"}),(0,a.jsx)("button",{onClick:()=>m(!x),className:"p-1 rounded-md bg-accent-cyan/20 text-accent-cyan hover:bg-accent-cyan/30 transition-colors",title:"Add Scene","aria-label":"Add Scene",children:(0,a.jsx)(T.Z,{size:14})})]}),(0,a.jsx)(y.M,{children:x&&(0,a.jsx)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 overflow-hidden",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"Scene name",className:"input-field flex-1 text-sm",onKeyDown:e=>"Enter"===e.key&&p()}),(0,a.jsx)("button",{onClick:p,disabled:!u.trim(),className:"px-3 py-2 rounded-lg bg-accent-cyan text-white text-sm disabled:opacity-50",children:"Add"})]})})}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:s.map(e=>(0,a.jsxs)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>c(e),onDoubleClick:()=>o(e),className:(0,f.cn)("p-3 rounded-xl text-left transition-all",(null==n?void 0:n.id)===e.id?"bg-accent-cyan/20 border border-accent-cyan/50 shadow-neon-cyan":"bg-white/5 hover:bg-white/10 border border-transparent"),children:[(0,a.jsx)("div",{className:"aspect-video bg-surface-500 rounded-lg mb-2 flex items-center justify-center",children:(0,a.jsx)(g.Z,{size:20,className:"text-gray-500"})}),(0,a.jsx)("span",{className:"text-xs font-medium truncate block",children:e.name}),(0,a.jsxs)("span",{className:"text-[10px] text-gray-500",children:[e.sources.length," sources"]})]},e.id))})]})}var M=s(4767),O=s(5349),V=s(9219),B=s(3276),G=s(9227),H=s(1706),W=s(8623),J=s(7414),K=s(3247),X=s(6595),Q=s(5468),q=s(257);function Y(e){let{streamId:t,className:s}=e,{chatMessages:n,chatPaused:r,toggleChatPause:c,addChatMessage:o,clearChat:d}=v(),[x,m]=(0,i.useState)("all"),[h,g]=(0,i.useState)(""),[b,j]=(0,i.useState)(!1),[N,w]=(0,i.useState)(!1),[S,z]=(0,i.useState)(!0),Z=(0,i.useRef)(null);(0,i.useEffect)(()=>{!r&&Z.current&&(Z.current.scrollTop=Z.current.scrollHeight)},[n,r]);let C=e=>{switch(e.toLowerCase()){case"youtube":return(0,a.jsx)(M.Z,{size:12,className:"text-red-500"});case"twitch":return(0,a.jsx)(O.Z,{size:12,className:"text-purple-500"});case"facebook":return(0,a.jsx)(V.Z,{size:12,className:"text-blue-500"});default:return(0,a.jsx)(u.Z,{size:12,className:"text-gray-400"})}},E=n.filter(e=>!!(("all"===x||e.platform.toLowerCase()===x)&&(!h||e.message.toLowerCase().includes(h.toLowerCase())||e.username.toLowerCase().includes(h.toLowerCase())))),T=e=>{console.log("Highlight message:",e)},A=e=>{console.log("Ban user:",e)},I=async e=>{try{let t=await fetch("".concat(q.env.NEXT_PUBLIC_API_URL,"/api/ai/chat-response"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e.message,streamTopic:"general",previousResponses:[]})}),s=await t.json();s.response&&o({id:"ai-".concat(Date.now()),platform:"ai",username:"AI Assistant",message:s.response,timestamp:new Date,highlighted:!0,badges:["ai"]})}catch(e){console.error("Failed to generate AI response:",e)}};return(0,a.jsxs)("div",{className:(0,f.cn)("glass rounded-2xl flex flex-col h-full",s),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-white/10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,a.jsx)(u.Z,{size:18,className:"text-accent-pink"}),"Live Chat",(0,a.jsx)("span",{className:"text-xs bg-accent-pink/20 text-accent-pink px-2 py-0.5 rounded-full",children:n.length})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:c,className:(0,f.cn)("p-1.5 rounded-lg transition-colors",r?"bg-yellow-500/20 text-yellow-400":"bg-white/5 text-gray-400 hover:bg-white/10"),title:r?"Resume":"Pause",children:r?(0,a.jsx)(B.Z,{size:14}):(0,a.jsx)(G.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>j(!b),className:(0,f.cn)("p-1.5 rounded-lg transition-colors",b?"bg-accent-cyan/20 text-accent-cyan":"bg-white/5 text-gray-400 hover:bg-white/10"),title:"Settings",children:(0,a.jsx)(p.Z,{size:14})}),(0,a.jsx)("button",{onClick:d,className:"p-1.5 rounded-lg bg-white/5 text-gray-400 hover:bg-red-500/20 hover:text-red-400 transition-colors",title:"Clear Chat",children:(0,a.jsx)(_.Z,{size:14})})]})]}),(0,a.jsx)(y.M,{children:b&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2 mb-3 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-white/5",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-400 flex items-center gap-2",children:[N?(0,a.jsx)(H.Z,{size:14}):(0,a.jsx)(W.Z,{size:14}),"Text-to-Speech"]}),(0,a.jsx)("button",{onClick:()=>w(!N),className:(0,f.cn)("w-10 h-5 rounded-full transition-colors relative",N?"bg-accent-cyan":"bg-gray-600"),title:N?"Disable TTS":"Enable TTS","aria-label":N?"Disable TTS":"Enable TTS",children:(0,a.jsx)("div",{className:(0,f.cn)("absolute top-0.5 w-4 h-4 rounded-full bg-white transition-all",N?"left-5":"left-0.5")})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-white/5",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-400 flex items-center gap-2",children:[(0,a.jsx)(J.Z,{size:14}),"Highlight Donations"]}),(0,a.jsx)("button",{onClick:()=>z(!S),className:(0,f.cn)("w-10 h-5 rounded-full transition-colors relative",S?"bg-accent-cyan":"bg-gray-600"),title:S?"Hide Donation Highlights":"Show Donation Highlights","aria-label":S?"Hide Donation Highlights":"Show Donation Highlights",children:(0,a.jsx)("div",{className:(0,f.cn)("absolute top-0.5 w-4 h-4 rounded-full bg-white transition-all",S?"left-5":"left-0.5")})})]})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(K.Z,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"Search messages...",className:"input-field pl-9 text-xs py-2"})]}),(0,a.jsxs)("select",{value:x,onChange:e=>m(e.target.value),className:"input-field text-xs py-2 w-24",title:"Filter by platform",children:[(0,a.jsx)("option",{value:"all",children:"All"}),(0,a.jsx)("option",{value:"youtube",children:"YouTube"}),(0,a.jsx)("option",{value:"twitch",children:"Twitch"}),(0,a.jsx)("option",{value:"facebook",children:"Facebook"})]})]})]}),(0,a.jsx)("div",{ref:Z,className:"flex-1 overflow-y-auto p-3 space-y-2",children:0===E.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(u.Z,{size:32,className:"mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"No messages yet"})]}):(0,a.jsx)(y.M,{initial:!1,children:E.map(e=>{var t;return(0,a.jsx)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-10},className:(0,f.cn)("group p-2.5 rounded-xl transition-colors",e.highlighted?"bg-accent-cyan/10 border border-accent-cyan/30":e.donation&&S?"bg-accent-orange/10 border border-accent-orange/30":"bg-white/5 hover:bg-white/8"),children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-accent-cyan to-accent-purple flex items-center justify-center flex-shrink-0",children:e.userAvatar?(0,a.jsx)("img",{src:e.userAvatar,alt:"",className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{className:"text-xs font-bold text-white",children:e.username.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 mb-0.5",children:[C(e.platform),(0,a.jsx)("span",{className:"text-xs font-semibold truncate",children:e.username}),null===(t=e.badges)||void 0===t?void 0:t.map(e=>(0,a.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-accent-purple/20 text-accent-purple",children:e},e)),e.donation&&(0,a.jsxs)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-accent-orange/20 text-accent-orange flex items-center gap-0.5",children:[(0,a.jsx)(J.Z,{size:10}),e.donation.currency,e.donation.amount]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-200 break-words",children:e.message}),(0,a.jsx)("span",{className:"text-[10px] text-gray-500 mt-1 block",children:(0,f.BK)(e.timestamp)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("button",{onClick:()=>T(e.id),className:"p-1 rounded text-gray-400 hover:text-yellow-400 hover:bg-yellow-400/20",title:"Highlight",children:(0,a.jsx)(X.Z,{size:12})}),(0,a.jsx)("button",{onClick:()=>I(e),className:"p-1 rounded text-gray-400 hover:text-accent-cyan hover:bg-accent-cyan/20",title:"AI Response",children:(0,a.jsx)(k.Z,{size:12})}),(0,a.jsx)("button",{onClick:()=>A(e.username),className:"p-1 rounded text-gray-400 hover:text-red-400 hover:bg-red-400/20",title:"Ban User",children:(0,a.jsx)(Q.Z,{size:12})})]})]})},e.id)})})}),r&&(0,a.jsx)("div",{className:"px-4 py-2 bg-yellow-500/20 border-t border-yellow-500/30 text-center",children:(0,a.jsxs)("span",{className:"text-xs text-yellow-400 flex items-center justify-center gap-1",children:[(0,a.jsx)(G.Z,{size:12}),"Chat paused - Scroll to see new messages"]})})]})}var $=s(2926),ee=s(5395),et=s(730),es=s(8178),ea=s(401),ei=s(8867),el=s(2489),en=s(9345),er=s(4743),ec=s(257);function eo(e){let{streamId:t,className:s}=e,{guests:n,addGuest:r,removeGuest:c,updateGuestStatus:o}=v(),[d,u]=(0,i.useState)(!1),[p,g]=(0,i.useState)(""),[b,N]=(0,i.useState)(""),[w,S]=(0,i.useState)(!1),[k,z]=(0,i.useState)(null),Z=async()=>{if(b.trim()){S(!0);try{let e=await fetch("".concat(ec.env.NEXT_PUBLIC_API_URL,"/api/guests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({streamId:t,name:b,email:p})}),s=await e.json();s.guest&&(r(s.guest),N(""),g(""),u(!1))}catch(e){console.error("Failed to invite guest:",e)}finally{S(!1)}}},C=async e=>{try{await fetch("".concat(ec.env.NEXT_PUBLIC_API_URL,"/api/guests/").concat(e),{method:"DELETE"}),c(e)}catch(e){console.error("Failed to remove guest:",e)}},E=(e,t)=>{let s="".concat(window.location.origin,"/guest/join/").concat(t);navigator.clipboard.writeText(s),z(e),setTimeout(()=>z(null),2e3)},T=e=>{switch(e){case"connected":return"bg-green-500";case"waiting":return"bg-yellow-500";case"invited":return"bg-blue-500";default:return"bg-gray-500"}},A=e=>{switch(e){case"excellent":case"good":return(0,a.jsx)($.Z,{size:14,className:"text-green-400"});case"fair":return(0,a.jsx)($.Z,{size:14,className:"text-yellow-400"});default:return(0,a.jsx)(ee.Z,{size:14,className:"text-red-400"})}};return(0,a.jsxs)("div",{className:(0,f.cn)("glass rounded-2xl p-4",s),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,a.jsx)(j.Z,{size:18,className:"text-accent-purple"}),"Guests",n.length>0&&(0,a.jsx)("span",{className:"text-xs bg-accent-purple/20 text-accent-purple px-2 py-0.5 rounded-full",children:n.length})]}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"p-2 rounded-lg bg-accent-purple/20 hover:bg-accent-purple/30 text-accent-purple transition-colors",title:"Invite Guest",children:(0,a.jsx)(h.Z,{size:16})})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:0===n.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(j.Z,{size:32,className:"mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"No guests yet"}),(0,a.jsx)("p",{className:"text-xs",children:"Invite guests to join your stream"})]}):n.map(e=>(0,a.jsxs)(l.E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent-cyan to-accent-purple flex items-center justify-center font-bold text-white",children:e.name.charAt(0).toUpperCase()}),(0,a.jsx)("div",{className:(0,f.cn)("absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-surface-300",T(e.status))})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium truncate",children:e.name}),"connected"===e.status&&A(e.connectionQuality)]}),(0,a.jsx)("span",{className:"text-xs text-gray-400 capitalize",children:e.status})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:["connected"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:(0,f.cn)("p-1.5 rounded-lg transition-colors",e.audioEnabled?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),title:e.audioEnabled?"Mute":"Unmute",children:e.audioEnabled?(0,a.jsx)(x.Z,{size:14}):(0,a.jsx)(et.Z,{size:14})}),(0,a.jsx)("button",{className:(0,f.cn)("p-1.5 rounded-lg transition-colors",e.videoEnabled?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),title:e.videoEnabled?"Hide Video":"Show Video",children:e.videoEnabled?(0,a.jsx)(m.Z,{size:14}):(0,a.jsx)(es.Z,{size:14})})]}),"invited"===e.status&&(0,a.jsx)("button",{onClick:()=>E(e.id,e.id),className:"p-1.5 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors",title:"Copy Invite Link",children:k===e.id?(0,a.jsx)(ea.Z,{size:14}):(0,a.jsx)(ei.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>C(e.id),className:"p-1.5 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors",title:"Remove Guest",children:(0,a.jsx)(el.Z,{size:14})})]})]},e.id))}),(0,a.jsx)(y.M,{children:d&&(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>u(!1),children:(0,a.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"glass rounded-2xl p-6 w-full max-w-md m-4",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[(0,a.jsx)(h.Z,{size:24,className:"text-accent-purple"}),"Invite Guest"]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-400 mb-1.5",children:"Name *"}),(0,a.jsx)("input",{type:"text",value:b,onChange:e=>N(e.target.value),placeholder:"Guest name",className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-400 mb-1.5",children:"Email (optional)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(en.Z,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"email",value:p,onChange:e=>g(e.target.value),placeholder:"guest@example.com",className:"input-field pl-10"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-3 rounded-xl bg-white/10 hover:bg-white/20 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:Z,disabled:!b.trim()||w,className:(0,f.cn)("flex-1 px-4 py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2",b.trim()&&!w?"bg-accent-purple text-white hover:bg-accent-purple/80":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:w?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er.Z,{size:16}),"Send Invite"]})})]})]})})})]})}function ed(e){let{className:t}=e,{guests:s}=v(),i=s.filter(e=>"connected"===e.status);if(0===i.length)return null;let l=1===i.length?1:i.length<=4?2:3;return(0,a.jsx)("div",{className:(0,f.cn)("grid gap-2",1===l?"grid-cols-1":2===l?"grid-cols-2":"grid-cols-3",t),children:i.map(e=>(0,a.jsxs)("div",{className:"relative aspect-video bg-surface-400 rounded-xl overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-accent-cyan/20 to-accent-purple/20",children:(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-accent-cyan to-accent-purple flex items-center justify-center font-bold text-2xl text-white",children:e.name.charAt(0).toUpperCase()})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/80 to-transparent",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium truncate",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[!e.audioEnabled&&(0,a.jsx)(et.Z,{size:12,className:"text-red-400"}),!e.videoEnabled&&(0,a.jsx)(es.Z,{size:12,className:"text-red-400"})]})]})})]},e.id))})}function ex(e){let{className:t}=e,{stream:s,isStreaming:i,streamDuration:g,toggleSidebar:b,sidebarOpen:j}=v();return(0,a.jsxs)("header",{className:(0,f.cn)("h-16 glass border-b border-white/10 flex items-center justify-between px-6",t),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:b,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:j?(0,a.jsx)(n.Z,{size:20}):(0,a.jsx)(r.Z,{size:20})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-accent-cyan to-accent-purple flex items-center justify-center",children:(0,a.jsx)(c.Z,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-bold text-lg leading-tight",children:(null==s?void 0:s.title)||"AI Avatar Studio"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:i?"Broadcasting Live":"Offline"})]})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-6",children:i&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"live-indicator px-4 py-2 rounded-full bg-red-500/20 text-red-400 font-semibold text-sm",children:"LIVE"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,a.jsx)(o.Z,{size:16}),(0,a.jsx)("span",{className:"font-mono",children:(0,f.LU)(g)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,a.jsx)(d.Z,{size:16}),(0,a.jsx)("span",{children:(0,f.uf)((null==s?void 0:s.viewerCount)||0)})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(em,{icon:(0,a.jsx)(x.Z,{size:18}),active:!0}),(0,a.jsx)(em,{icon:(0,a.jsx)(m.Z,{size:18}),active:!0}),(0,a.jsx)(em,{icon:(0,a.jsx)(u.Z,{size:18})}),(0,a.jsx)(em,{icon:(0,a.jsx)(h.Z,{size:18})}),(0,a.jsx)("div",{className:"w-px h-8 bg-white/10 mx-2"}),(0,a.jsx)("button",{className:"p-2.5 rounded-xl hover:bg-white/10 transition-colors",title:"Studio Settings","aria-label":"Studio Settings",children:(0,a.jsx)(p.Z,{size:20,className:"text-gray-400"})})]})]})}function em(e){let{icon:t,active:s=!1}=e;return(0,a.jsx)("button",{className:(0,f.cn)("p-2.5 rounded-xl transition-all duration-200",s?"bg-accent-cyan/20 text-accent-cyan":"bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white"),children:t})}function eu(e){let{className:t}=e,{sidebarOpen:s,activePanel:i,setActivePanel:n,scenes:r,activeScene:c,chatMessages:o,guests:d,stream:x}=v();if(!s)return null;let m=[{id:"scenes",icon:(0,a.jsx)(g.Z,{size:20}),label:"Scenes",count:r.length},{id:"layout",icon:(0,a.jsx)(b.Z,{size:20}),label:"Layout",count:(null==c?void 0:c.sources.length)||0},{id:"chat",icon:(0,a.jsx)(u.Z,{size:20}),label:"Chat",count:o.length},{id:"guests",icon:(0,a.jsx)(j.Z,{size:20}),label:"Guests",count:d.length},{id:"settings",icon:(0,a.jsx)(p.Z,{size:20}),label:"Settings"}],h=(null==x?void 0:x.id)||"";return(0,a.jsxs)(l.E.aside,{initial:{width:0,opacity:0},animate:{width:320,opacity:1},exit:{width:0,opacity:0},className:(0,f.cn)("h-full glass-dark border-r border-white/10 flex flex-col",t),children:[(0,a.jsx)("div",{className:"flex border-b border-white/10",children:m.map(e=>(0,a.jsxs)("button",{onClick:()=>n(e.id),className:(0,f.cn)("flex-1 py-3 px-2 flex flex-col items-center gap-1 transition-all duration-200 relative",i===e.id?"text-accent-cyan":"text-gray-400 hover:text-white"),title:e.label,children:[e.icon,(0,a.jsx)("span",{className:"text-[10px] font-medium",children:e.label}),void 0!==e.count&&e.count>0&&(0,a.jsx)("span",{className:"absolute top-1 right-1 w-4 h-4 rounded-full bg-accent-purple text-[10px] flex items-center justify-center text-white",children:e.count>99?"99+":e.count}),i===e.id&&(0,a.jsx)(l.E.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent-cyan"})]},e.id))}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:["scenes"===i&&(0,a.jsx)(R,{}),"layout"===i&&(0,a.jsx)(U,{}),"chat"===i&&(0,a.jsx)(Y,{streamId:h}),"guests"===i&&(0,a.jsx)(eo,{streamId:h}),"settings"===i&&(0,a.jsx)(eh,{})]})]})}function eh(){return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Stream Settings"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-400 mb-1.5",children:"Stream Title"}),(0,a.jsx)("input",{type:"text",className:"input-field",placeholder:"Enter stream title...",defaultValue:"AI Avatar Livestream"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-400 mb-1.5",children:"Description"}),(0,a.jsx)("textarea",{className:"input-field min-h-[80px] resize-none",placeholder:"Enter description..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-400 mb-1.5",children:"Quality"}),(0,a.jsxs)("select",{className:"input-field",title:"Stream Quality",children:[(0,a.jsx)("option",{children:"1080p 60fps"}),(0,a.jsx)("option",{children:"1080p 30fps"}),(0,a.jsx)("option",{children:"720p 60fps"}),(0,a.jsx)("option",{children:"720p 30fps"})]})]})]})]})}var ep=s(7416),eg=s(1094),eb=s(5287);let ej=s(257).env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api";async function ef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=await fetch("".concat(ej).concat(e),{...t,headers:{"Content-Type":"application/json",...t.headers}});if(!s.ok)return{error:(await s.json()).error||"Request failed"};return{data:await s.json()}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}}let ev={create:e=>ef("/streams",{method:"POST",body:JSON.stringify(e)}),getByUser:e=>ef("/streams/user/".concat(e))},ey={list:()=>ef("/avatars"),listVoices:()=>ef("/voices"),createSession:(e,t)=>ef("/avatar/session",{method:"POST",body:JSON.stringify({avatarId:e,streamId:t})}),startSession:(e,t)=>ef("/avatar/session/start",{method:"POST",body:JSON.stringify({sessionId:e,sdpAnswer:t})}),speak:e=>ef("/avatar/speak",{method:"POST",body:JSON.stringify(e)})},eN={generateScript:(e,t,s)=>ef("/ai/generate-script",{method:"POST",body:JSON.stringify({topic:e,style:t,duration:s})}),getChatResponse:(e,t,s)=>ef("/ai/chat-response",{method:"POST",body:JSON.stringify({question:e,streamTopic:t,previousResponses:s})})},ew={list:e=>ef("/scenes/".concat(e))};var eS=s(5863),ek=s(2252);function ez(e){let{avatarId:t,streamId:s,className:l,onSessionCreated:n}=e,r=v(e=>e.setAvatarSessionId),c=(0,i.useRef)(null),o=(0,i.useRef)(null),[d,x]=(0,i.useState)("idle"),[m,u]=(0,i.useState)(null);(0,i.useEffect)(()=>(t&&s&&h(),()=>{p()}),[t,s]);let h=async()=>{try{x("linking"),u(null);let e=await ey.createSession(t,s);if(!e.data||!e.data.session)throw Error(e.error||"Failed to create avatar session");let{session_id:a,sdp:i,ice_servers:l}=e.data.session;r(a),n&&n(a),o.current=new RTCPeerConnection({iceServers:l.map(e=>({urls:e.urls}))}),o.current.ontrack=e=>{c.current&&e.streams[0]&&(c.current.srcObject=e.streams[0],x("streaming"))},await o.current.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:i}));let d=await o.current.createAnswer();await o.current.setLocalDescription(d);let m=await ey.startSession(a,d.sdp);if(m.error)throw Error(m.error)}catch(e){console.error("WebRTC Error:",e),u(e instanceof Error?e.message:"Streaming failed"),x("error")}},p=()=>{r(null),o.current&&(o.current.close(),o.current=null),c.current&&(c.current.srcObject=null)};return(0,a.jsxs)("div",{className:(0,f.cn)("relative bg-surface-400 rounded-xl overflow-hidden aspect-video",l),children:[(0,a.jsx)("video",{ref:c,autoPlay:!0,playsInline:!0,className:(0,f.cn)("w-full h-full object-cover transition-opacity duration-1000","streaming"===d?"opacity-100":"opacity-0")}),"linking"===d&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-surface-400/80 backdrop-blur-sm",children:[(0,a.jsx)(eS.Z,{size:32,className:"text-accent-cyan animate-spin mb-3"}),(0,a.jsx)("p",{className:"text-sm font-medium text-white/80",children:"Connecting to AI Avatar..."})]}),"error"===d&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-red-500/10 backdrop-blur-sm p-6 text-center",children:[(0,a.jsx)(ek.Z,{size:32,className:"text-red-400 mb-3"}),(0,a.jsx)("p",{className:"text-sm font-medium text-red-300 mb-1",children:"Connection Failed"}),(0,a.jsx)("p",{className:"text-xs text-red-200/60 max-w-[200px]",children:m}),(0,a.jsx)("button",{onClick:h,className:"mt-4 px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-xs text-red-300 transition-colors",children:"Try Again"})]}),"idle"===d&&!t&&(0,a.jsx)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:(0,a.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Select an avatar to start session"})})]})}function eZ(e){let{className:t}=e,{activeScene:s,isStreaming:n,streamDuration:r,updateStreamDuration:c,activeAvatar:o,stream:x}=v(),[m,u]=(0,i.useState)(!1),[h,g]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let e;return n&&(e=setInterval(()=>{c(r+1)},1e3)),()=>clearInterval(e)},[n,r,c]),(0,a.jsx)("div",{className:(0,f.cn)("relative rounded-2xl overflow-hidden",t),children:(0,a.jsxs)("div",{className:"aspect-video bg-surface-400 relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:s?(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"w-full h-full bg-surface-500 flex items-center justify-center overflow-hidden",children:o?(0,a.jsx)(ez,{avatarId:o.id,streamId:(null==x?void 0:x.id)||"demo-stream",className:"w-full h-full"}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full bg-gradient-to-br from-accent-cyan/30 to-accent-purple/30 flex items-center justify-center backdrop-blur-xl",children:(0,a.jsx)(k.Z,{size:48,className:"text-accent-cyan"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-1",children:s.name}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm",children:[s.sources.length," sources configured"]})]})}):(0,a.jsxs)("div",{className:"text-center text-gray-500",children:[(0,a.jsx)(d.Z,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg",children:"No scene selected"}),(0,a.jsx)("p",{className:"text-sm",children:"Select a scene to preview"})]})}),(0,a.jsx)(y.M,{children:n&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-4 left-4 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"live-indicator px-3 py-1.5 rounded-lg bg-red-500/90 text-white font-bold text-sm backdrop-blur-sm",children:"LIVE"}),(0,a.jsx)("div",{className:"px-3 py-1.5 rounded-lg bg-black/50 text-white font-mono text-sm backdrop-blur-sm",children:(0,f.LU)(r)})]})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{onClick:()=>g(!h),className:"p-2 rounded-lg bg-black/40 hover:bg-black/60 transition-colors",children:h?(0,a.jsx)(W.Z,{size:18}):(0,a.jsx)(H.Z,{size:18})})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>u(!m),className:"p-2 rounded-lg bg-black/40 hover:bg-black/60 transition-colors",title:"Toggle Fullscreen","aria-label":"Toggle Fullscreen",children:(0,a.jsx)(ep.Z,{size:18})}),(0,a.jsx)("button",{className:"p-2 rounded-lg bg-black/40 hover:bg-black/60 transition-colors",title:"Settings","aria-label":"Settings",children:(0,a.jsx)(p.Z,{size:18})})]})]})})]})})}function eC(e){let{className:t}=e,{isStreaming:s,startStream:n,stopStream:r,stream:c}=v(),[o,d]=(0,i.useState)(!1),x=async()=>{s?r():(d(!0),await new Promise(e=>setTimeout(e,1500)),n(),d(!1))};return(0,a.jsxs)("div",{className:(0,f.cn)("flex items-center justify-center gap-4 py-4",t),children:[(0,a.jsxs)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:x,disabled:o,className:(0,f.cn)("relative px-8 py-4 rounded-2xl font-bold text-lg transition-all duration-300 flex items-center gap-3",s?"bg-red-500/20 text-red-400 border border-red-500/50 hover:bg-red-500/30":"bg-gradient-to-r from-accent-cyan to-accent-purple text-white shadow-neon-cyan hover:shadow-neon-purple",o&&"opacity-70 cursor-wait"),children:[(0,a.jsx)(y.M,{mode:"wait",children:o?(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"},"loading"):s?(0,a.jsx)(l.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:(0,a.jsx)(eg.Z,{size:24,fill:"currentColor"})},"stop"):(0,a.jsx)(l.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:(0,a.jsx)(eb.Z,{size:24})},"start")}),(0,a.jsx)("span",{children:o?"Connecting...":s?"End Stream":"Go Live"})]}),c&&c.platforms.length>0&&(0,a.jsx)("div",{className:"flex items-center gap-2",children:c.platforms.map(e=>(0,a.jsxs)("div",{className:(0,f.cn)("px-3 py-2 rounded-lg text-xs font-medium flex items-center gap-2","streaming"===e.status?"bg-green-500/20 text-green-400":"connected"===e.status?"bg-yellow-500/20 text-yellow-400":"bg-gray-500/20 text-gray-400"),children:[(0,a.jsx)("span",{className:(0,f.cn)("w-2 h-2 rounded-full","streaming"===e.status?"bg-green-400 animate-pulse":"bg-gray-400")}),(0,a.jsx)("span",{className:"capitalize",children:e.name})]},e.id))})]})}var eE=s(4972),eT=s(2820),eA=s(875);function eI(e){let{streamId:t,className:s}=e,[n,r]=(0,i.useState)("speak"),[c,o]=(0,i.useState)(""),[d,m]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1),[g,b]=(0,i.useState)([]),[j,N]=(0,i.useState)(null),[w,S]=(0,i.useState)(!1),[k,z]=(0,i.useState)([]),[Z,C]=(0,i.useState)(null),[E,T]=(0,i.useState)(!1),[A,I]=(0,i.useState)("elevenlabs"),[L,P]=(0,i.useState)(""),[_,F]=(0,i.useState)("professional"),[D,U]=(0,i.useState)(""),[R,M]=(0,i.useState)(""),[O,V]=(0,i.useState)(""),B=v(e=>e.avatarSessionId);async function G(){let{data:e}=await ey.list();e&&(b(e),e.length>0&&N(e[0]))}async function W(){let{data:e}=await ey.listVoices();e&&(z([...e.heygen,...e.elevenlabs]),e.elevenlabs.length>0&&C(e.elevenlabs[0]))}async function J(){if(c.trim()&&j){p(!0);try{let{data:e}=await ey.speak({sessionId:B||"demo-session",streamId:t||"demo-stream",text:c,voiceId:null==Z?void 0:Z.voice_id,useElevenLabs:"elevenlabs"===A});(null==e?void 0:e.duration)?setTimeout(()=>{p(!1),o("")},e.duration):p(!1)}catch(e){p(!1)}}}async function K(){if(L.trim()){m(!0);try{let{data:e}=await eN.generateScript(L,_,60);(null==e?void 0:e.script)&&U(e.script)}catch(e){console.error("Failed to generate script:",e)}finally{m(!1)}}}async function X(){if(R.trim()){m(!0);try{let{data:e}=await eN.getChatResponse(R,"AI Avatar Livestream Demo",[]);(null==e?void 0:e.response)&&V(e.response)}catch(e){console.error("Failed to get response:",e)}finally{m(!1)}}}return(0,i.useEffect)(()=>{G(),W()},[]),(0,a.jsxs)("div",{className:(0,f.cn)("glass rounded-2xl overflow-hidden",s),children:[(0,a.jsx)("div",{className:"p-4 border-b border-white/10",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-accent-cyan/30 to-accent-purple/30 flex items-center justify-center",children:(0,a.jsx)(eE.Z,{size:20,className:"text-accent-cyan"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:"AI Control Center"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Avatar speech, scripts, & chat responses"})]})]})}),(0,a.jsx)("div",{className:"flex border-b border-white/10",children:[{id:"speak",icon:(0,a.jsx)(x.Z,{size:16}),label:"Speak"},{id:"script",icon:(0,a.jsx)(eT.Z,{size:16}),label:"Script"},{id:"respond",icon:(0,a.jsx)(u.Z,{size:16}),label:"Respond"}].map(e=>(0,a.jsxs)("button",{onClick:()=>r(e.id),className:(0,f.cn)("flex-1 py-3 px-4 flex items-center justify-center gap-2 transition-all duration-200",n===e.id?"text-white bg-white/10":"text-gray-400 hover:text-white hover:bg-white/5"),children:[e.icon,(0,a.jsx)("span",{className:"text-sm font-medium",children:e.label})]},e.id))}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:["speak"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Avatar"}),(0,a.jsxs)("button",{onClick:()=>S(!w),className:"w-full px-3 py-2.5 rounded-xl bg-surface-300 border border-white/10 text-left flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm truncate",children:(null==j?void 0:j.avatar_name)||"Select Avatar"}),(0,a.jsx)(eA.Z,{size:16,className:"text-gray-400"})]}),(0,a.jsx)(y.M,{children:w&&(0,a.jsx)(l.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 bg-surface-200 border border-white/10 rounded-xl overflow-hidden z-50",children:g.map(e=>(0,a.jsxs)("button",{onClick:()=>{N(e),S(!1)},className:(0,f.cn)("w-full px-3 py-2 text-left text-sm flex items-center justify-between hover:bg-white/10",(null==j?void 0:j.avatar_id)===e.avatar_id&&"bg-white/5"),children:[(0,a.jsx)("span",{children:e.avatar_name}),(null==j?void 0:j.avatar_id)===e.avatar_id&&(0,a.jsx)(ea.Z,{size:14,className:"text-accent-cyan"})]},e.avatar_id))})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Voice"}),(0,a.jsxs)("button",{onClick:()=>T(!E),className:"w-full px-3 py-2.5 rounded-xl bg-surface-300 border border-white/10 text-left flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm truncate",children:(null==Z?void 0:Z.name)||"Select Voice"}),(0,a.jsx)(eA.Z,{size:16,className:"text-gray-400"})]}),(0,a.jsx)(y.M,{children:E&&(0,a.jsx)(l.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 bg-surface-200 border border-white/10 rounded-xl overflow-hidden z-50 max-h-48 overflow-y-auto",children:k.map(e=>(0,a.jsxs)("button",{onClick:()=>{C(e),T(!1)},className:(0,f.cn)("w-full px-3 py-2 text-left text-sm flex items-center justify-between hover:bg-white/10",(null==Z?void 0:Z.voice_id)===e.voice_id&&"bg-white/5"),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)("span",{className:"text-xs text-gray-400 ml-2",children:e.gender})]}),(null==Z?void 0:Z.voice_id)===e.voice_id&&(0,a.jsx)(ea.Z,{size:14,className:"text-accent-cyan"})]},e.voice_id))})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Provider:"}),(0,a.jsxs)("div",{className:"flex rounded-lg bg-surface-400 p-0.5",children:[(0,a.jsx)("button",{onClick:()=>I("elevenlabs"),className:(0,f.cn)("px-3 py-1 text-xs rounded-md transition-colors","elevenlabs"===A?"bg-accent-purple text-white":"text-gray-400 hover:text-white"),children:"ElevenLabs"}),(0,a.jsx)("button",{onClick:()=>I("heygen"),className:(0,f.cn)("px-3 py-1 text-xs rounded-md transition-colors","heygen"===A?"bg-accent-cyan text-white":"text-gray-400 hover:text-white"),children:"HeyGen"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Text to Speak"}),(0,a.jsx)("textarea",{value:c,onChange:e=>o(e.target.value),placeholder:"Enter text for the avatar to speak...",className:"input-field min-h-[100px] resize-none",disabled:h})]}),(0,a.jsx)("button",{onClick:J,disabled:!c.trim()||!j||h,className:(0,f.cn)("w-full py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2",c.trim()&&j&&!h?"bg-gradient-to-r from-accent-cyan to-accent-purple text-white hover:shadow-neon-cyan":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eS.Z,{size:18,className:"animate-spin"}),"Speaking..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.Z,{size:18}),"Speak Now"]})})]}),"script"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Topic"}),(0,a.jsx)("input",{type:"text",value:L,onChange:e=>P(e.target.value),placeholder:"What should the avatar talk about?",className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Style"}),(0,a.jsxs)("select",{value:_,onChange:e=>F(e.target.value),className:"input-field",title:"Script Style",children:[(0,a.jsx)("option",{value:"professional",children:"Professional"}),(0,a.jsx)("option",{value:"casual",children:"Casual & Friendly"}),(0,a.jsx)("option",{value:"educational",children:"Educational"}),(0,a.jsx)("option",{value:"entertaining",children:"Entertaining"}),(0,a.jsx)("option",{value:"inspiring",children:"Inspiring"})]})]}),(0,a.jsx)("button",{onClick:K,disabled:!L.trim()||d,className:(0,f.cn)("w-full py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2",L.trim()&&!d?"bg-accent-purple text-white hover:bg-accent-purple/80":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eS.Z,{size:18,className:"animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eT.Z,{size:18}),"Generate Script"]})}),D&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Generated Script"}),(0,a.jsx)("div",{className:"p-4 rounded-xl bg-surface-400 text-sm whitespace-pre-wrap",children:D}),(0,a.jsx)("button",{onClick:function(){o(D),r("speak")},className:"mt-2 w-full py-2 rounded-lg bg-white/10 text-sm hover:bg-white/20 transition-colors",children:"Use This Script"})]})]}),"respond"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Viewer Question"}),(0,a.jsx)("input",{type:"text",value:R,onChange:e=>M(e.target.value),placeholder:"Enter a viewer's question...",className:"input-field"})]}),(0,a.jsx)("button",{onClick:X,disabled:!R.trim()||d,className:(0,f.cn)("w-full py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2",R.trim()&&!d?"bg-accent-pink text-white hover:bg-accent-pink/80":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eS.Z,{size:18,className:"animate-spin"}),"Thinking..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eE.Z,{size:18}),"Generate Response"]})}),O&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1.5",children:"AI Response"}),(0,a.jsx)("div",{className:"p-4 rounded-xl bg-surface-400 text-sm",children:O}),(0,a.jsx)("button",{onClick:function(){o(O),r("speak")},className:"mt-2 w-full py-2 rounded-lg bg-white/10 text-sm hover:bg-white/20 transition-colors",children:"Speak This Response"})]})]})]})]})}var eL=s(8680);let eP=s(257).env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:3001";var e_=s(605),eF=s(9376),eD=s(525),eU=s(8997),eR=s(8919),eM=s(6221),eO=s(7168),eV=s(3085),eB=s(257);function eG(e){let{streamId:t,className:s}=e,{analytics:n,setAnalytics:r,stream:c,isStreaming:x,streamDuration:m}=v(),[p,g]=(0,i.useState)(!1),[b,y]=(0,i.useState)(0),N=(0,i.useCallback)(async()=>{if(t)try{g(!0);let e=await fetch("".concat(eB.env.NEXT_PUBLIC_API_URL,"/api/analytics/").concat(t)),s=await e.json();y((null==n?void 0:n.totalViewers)||0),r({totalViewers:s.totalViewers||0,peakViewers:s.peakViewers||0,averageWatchTime:s.averageWatchTime||0,chatMessages:s.chatMessages||0,reactions:s.reactions||0,shares:s.shares||0,newFollowers:s.newFollowers||0,platformBreakdown:s.platformBreakdown||[],viewerTimeline:s.viewerTimeline||[]})}catch(e){console.error("Failed to fetch analytics:",e)}finally{g(!1)}},[t,r,null==n?void 0:n.totalViewers]);(0,i.useEffect)(()=>{if(x&&t){N();let e=setInterval(N,1e4);return()=>clearInterval(e)}},[x,t,N]);let w=((null==n?void 0:n.totalViewers)||0)-b,S=b>0?(w/b*100).toFixed(1):"0",k=e=>{switch(e.toLowerCase()){case"youtube":return(0,a.jsx)(M.Z,{size:16,className:"text-red-500"});case"twitch":return(0,a.jsx)(O.Z,{size:16,className:"text-purple-500"});case"facebook":return(0,a.jsx)(V.Z,{size:16,className:"text-blue-500"});default:return(0,a.jsx)(B.Z,{size:16,className:"text-gray-400"})}},z=[{label:"Live Viewers",value:(null==c?void 0:c.viewerCount)||(null==n?void 0:n.totalViewers)||0,icon:(0,a.jsx)(j.Z,{size:18}),color:"cyan",trend:0!==w?{value:"".concat(w>0?"+":"").concat(S,"%"),positive:w>0}:null},{label:"Peak Viewers",value:(null==n?void 0:n.peakViewers)||0,icon:(0,a.jsx)(eD.Z,{size:18}),color:"purple"},{label:"Chat Messages",value:(null==n?void 0:n.chatMessages)||0,icon:(0,a.jsx)(u.Z,{size:18}),color:"pink"},{label:"Reactions",value:(null==n?void 0:n.reactions)||0,icon:(0,a.jsx)(eU.Z,{size:18}),color:"orange"},{label:"Shares",value:(null==n?void 0:n.shares)||0,icon:(0,a.jsx)(eR.Z,{size:18}),color:"green"},{label:"New Followers",value:(null==n?void 0:n.newFollowers)||0,icon:(0,a.jsx)(h.Z,{size:18}),color:"blue"}];return(0,a.jsxs)("div",{className:(0,f.cn)("glass rounded-2xl p-5",s),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-5",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(eM.Z,{size:20,className:"text-accent-cyan"}),"Live Analytics"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[x&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-500/20",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),(0,a.jsx)("span",{className:"text-xs font-medium text-red-400",children:(0,f.LU)(m)})]}),(0,a.jsx)("button",{onClick:N,disabled:p,className:(0,f.cn)("p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",p&&"animate-spin"),title:"Refresh Analytics",children:(0,a.jsx)(eO.Z,{size:14})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-5",children:z.map((e,t)=>(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"p-3 rounded-xl bg-white/5 hover:bg-white/8 transition-colors",children:[(0,a.jsx)("div",{className:(0,f.cn)("w-8 h-8 rounded-lg mb-2 flex items-center justify-center","cyan"===e.color&&"bg-accent-cyan/20 text-accent-cyan","purple"===e.color&&"bg-accent-purple/20 text-accent-purple","pink"===e.color&&"bg-accent-pink/20 text-accent-pink","orange"===e.color&&"bg-accent-orange/20 text-accent-orange","green"===e.color&&"bg-green-500/20 text-green-400","blue"===e.color&&"bg-blue-500/20 text-blue-400"),children:e.icon}),(0,a.jsxs)("div",{className:"flex items-end gap-1.5",children:[(0,a.jsx)("span",{className:"text-xl font-bold",children:(0,f.uf)(e.value)}),e.trend&&(0,a.jsxs)("span",{className:(0,f.cn)("text-xs flex items-center gap-0.5 mb-0.5",e.trend.positive?"text-green-400":"text-red-400"),children:[e.trend.positive?(0,a.jsx)(eD.Z,{size:10}):(0,a.jsx)(eV.Z,{size:10}),e.trend.value]})]}),(0,a.jsx)("span",{className:"text-[10px] text-gray-500",children:e.label})]},e.label))}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 rounded-xl bg-white/5",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[(0,a.jsx)(d.Z,{size:14}),"Platform Breakdown"]}),(null==n?void 0:n.platformBreakdown)&&n.platformBreakdown.length>0?(0,a.jsx)("div",{className:"space-y-3",children:n.platformBreakdown.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[k(e.platform),(0,a.jsx)("span",{className:"text-sm text-gray-400 w-16 capitalize",children:e.platform}),(0,a.jsx)("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:(0,a.jsx)(l.E.div,{initial:{width:0},animate:{width:"".concat(e.percentage,"%")},transition:{duration:.8,ease:"easeOut"},className:(0,f.cn)("h-full rounded-full","youtube"===e.platform&&"bg-red-500","twitch"===e.platform&&"bg-purple-500","facebook"===e.platform&&"bg-blue-500",!["youtube","twitch","facebook"].includes(e.platform)&&"bg-gray-500")})}),(0,a.jsx)("span",{className:"text-sm font-medium w-12 text-right",children:(0,f.uf)(e.viewers)})]},e.platform))}):(0,a.jsx)("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No platform data yet"})]}),(0,a.jsxs)("div",{className:"p-4 rounded-xl bg-white/5",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[(0,a.jsx)(o.Z,{size:14}),"Stream Metrics"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Avg. Watch Time"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:(null==n?void 0:n.averageWatchTime)?(0,f.LU)(n.averageWatchTime):"--:--"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Stream Duration"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:(0,f.LU)(m)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Engagement Rate"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[n&&n.totalViewers>0?((n.chatMessages+n.reactions)/n.totalViewers*100).toFixed(1):"0","%"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Chat Rate"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[m>0?Math.round(((null==n?void 0:n.chatMessages)||0)/(m/60)):0,"/min"]})]})]})]})]})]})}let eH={id:"avatar-1",name:"Alex - Professional Host",provider:"heygen",thumbnailUrl:"",voiceId:"voice-1",status:"idle",settings:{language:"en-US",emotion:"neutral",speed:1,pitch:1,volume:1}};function eW(){let{data:e,status:t}=(0,e_.useSession)(),s=(0,eF.useRouter)(),[n,r]=(0,i.useState)(""),{setScenes:c,setActiveScene:o,setStream:d,setAvatars:x,setActiveAvatar:m,setAnalytics:u,stream:h,isStreaming:p}=v(),{socket:g}=function(e){let t=(0,i.useRef)(null),{addChatMessage:s,addGuest:a,removeGuest:l,updateGuestStatus:n,setAnalytics:r}=v();(0,i.useEffect)(()=>{t.current=(0,eL.io)(eP,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});let i=t.current;return i.on("connect",()=>{console.log("Connected to WebSocket server"),e&&i.emit("stream:join",e)}),i.on("disconnect",()=>{console.log("Disconnected from WebSocket server")}),i.on("chat:message",e=>{s({id:e.id||"msg-".concat(Date.now()),platform:e.platform,username:e.username,message:e.message,timestamp:new Date(e.timestamp),highlighted:e.highlighted||!1,donation:e.donation})}),i.on("guest:joined",e=>{a({id:e.guestId,name:e.name,status:"connected",videoEnabled:!0,audioEnabled:!0,connectionQuality:"good"})}),i.on("guest:left",e=>{l(e.guestId)}),i.on("stream:viewers",e=>{let t=v.getState();t.stream&&t.setStream({...t.stream,viewerCount:e.count})}),()=>{i.disconnect()}},[e,s,a,l]);let c=(0,i.useCallback)(s=>{t.current&&e&&t.current.emit("stream:start",{streamId:e,platforms:s})},[e]),o=(0,i.useCallback)(()=>{t.current&&e&&t.current.emit("stream:stop",e)},[e]),d=(0,i.useCallback)(s=>{t.current&&e&&t.current.emit("scene:switch",{streamId:e,sceneId:s})},[e]),x=(0,i.useCallback)((s,a)=>{t.current&&e&&t.current.emit("avatar:speak",{streamId:e,text:s,avatarId:a})},[e]),m=(0,i.useCallback)(s=>{t.current&&e&&t.current.emit("chat:send",{streamId:e,message:s})},[e]);return{socket:t.current,startStream:c,stopStream:o,switchScene:d,speakWithAvatar:x,sendChatMessage:m}}(n||void 0);return((0,i.useEffect)(()=>{"unauthenticated"===t&&s.push("/auth/signin")},[t,s]),(0,i.useEffect)(()=>{var s;"authenticated"===t&&(null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.id)&&(async()=>{try{let t;let s=await ev.getByUser(e.user.id);if(s.data&&s.data.length>0)t=s.data[0];else{let s=await ev.create({title:"".concat(e.user.name||"User","'s Studio"),description:"AI-Powered Livestream Session",platforms:[{name:"youtube",streamKey:"demo-key"},{name:"twitch",streamKey:"demo-key"},{name:"facebook",streamKey:"demo-key"}],quality:"1080p30"});if(s.data)t=s.data.stream;else throw Error("Failed to create stream")}r(t.id),d(t);let a=await ew.list(t.id);if(a.data){c(a.data);let e=a.data.find(e=>e.isActive)||a.data[0];e&&o(e)}x([eH]),m(eH)}catch(e){console.error("Error initializing studio:",e)}})()},[t,e,d,c,o,x,m]),"loading"===t)?(0,a.jsx)("div",{className:"h-screen w-full flex items-center justify-center bg-surface-500",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-accent-cyan border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-400 font-medium",children:"Loading Studio..."})]})}):e?(0,a.jsxs)("div",{className:"h-screen flex flex-col bg-surface-500 overflow-hidden",children:[(0,a.jsx)(ex,{}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsx)(eu,{}),(0,a.jsx)("main",{className:"flex-1 flex flex-col overflow-y-auto custom-scrollbar",children:(0,a.jsxs)("div",{className:"p-4 lg:p-6 space-y-4 lg:space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 lg:gap-6",children:[(0,a.jsxs)("div",{className:"xl:col-span-2 space-y-4",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"aspect-video glass rounded-2xl overflow-hidden relative",children:[(0,a.jsx)(eZ,{className:"h-full w-full"}),(0,a.jsx)("div",{className:"absolute bottom-4 left-4 right-4 pointer-events-none",children:(0,a.jsx)(ed,{className:"max-w-[400px] pointer-events-auto"})})]}),(0,a.jsx)(eC,{})]}),(0,a.jsx)(l.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"h-full",children:(0,a.jsx)(eI,{streamId:n})})]}),(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,a.jsx)(eG,{streamId:n})})]})})]})]}):null}},3448:function(e,t,s){"use strict";s.d(t,{BK:function(){return c},LU:function(){return n},cn:function(){return l},uf:function(){return r}});var a=s(1994),i=s(3335);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.m6)((0,a.W)(t))}function n(e){let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return t>0?"".concat(t,":").concat(s.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")):"".concat(s,":").concat(a.toString().padStart(2,"0"))}function r(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}function c(e){let t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/1e3);return a<60?"just now":a<3600?"".concat(Math.floor(a/60),"m ago"):a<86400?"".concat(Math.floor(a/3600),"h ago"):"".concat(Math.floor(a/86400),"d ago")}}},function(e){e.O(0,[746,605,834,34,971,117,744],function(){return e(e.s=7945)}),_N_E=e.O()}]);